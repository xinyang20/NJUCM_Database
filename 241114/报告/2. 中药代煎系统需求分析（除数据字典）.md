## **2. 中药代煎系统需求分析**

### **2.1 系统主要功能**

中药代煎系统旨在实现患者、医生、处方、代煎药院、代煎机器等多方数据的管理与追踪，提供从处方登记到代煎完成的全过程记录与可视化支持。主要功能包括：

#### **1. 患者信息管理**
- 管理患者的基本信息（如姓名、联系方式等）。
- 支持添加、删除、修改、查询患者信息。

#### **2. 医生与处方管理**
- **医生管理**：维护医生的基本信息和所属科室。
- **处方管理**：记录处方的详细信息，包括关联患者和医生的处方开具信息（剂数、用法、金额、重量等）。

#### **3. 代煎管理**
- 管理代煎药院信息，包括药院的设备和人员信息。
- **代煎机器管理**：追踪每台机器的使用情况（空闲、使用中、维护中）。

#### **4. 煎药记录**
- 记录代煎全过程：从配方、浸泡到煎药的具体操作时间、操作人员及机器使用情况。
- 实现时间节点管理，如收方时间、煎药开始与结束时间、成品打印时间等。

#### **5. 数据统计与可视化**
- 提供统计报表功能，如：
  - 每日处理的处方数量。
  - 每台机器的使用率。
  - 每个代煎药院的工作效率。
- 支持可视化展示，便于快速了解系统运行情况。

---

### **2.2 数据字典（忽略）**

以下是系统主要数据项及其说明：

| **数据项名称（英文）** | **说明（中文名）** | **类型**      | **取值范围或格式**  |
| ---------------------- | ------------------ | ------------- | ------------------- |
| patient_id             | 患者ID             | INT           | 主键，自动生成      |
| patient_name           | 患者姓名           | VARCHAR(50)   | 非空，任意字符串    |
| contact_number         | 联系方式           | VARCHAR(15)   | 电话号码格式        |
| doctor_id              | 医生ID             | INT           | 主键，自动生成      |
| doctor_name            | 医生姓名           | VARCHAR(50)   | 非空，任意字符串    |
| department_name        | 所属科室           | VARCHAR(50)   | 非空，任意字符串    |
| prescription_id        | 处方编号           | INT           | 主键，自动生成      |
| pickup_method          | 取药方式           | VARCHAR(20)   | 自取/配送           |
| prescription_date      | 开方日期           | DATE          | YYYY-MM-DD          |
| prescription_amount    | 处方金额           | DECIMAL(10,2) | 非负数              |
| prescription_weight    | 处方重量           | FLOAT         | 非负数              |
| dose_count             | 剂数               | INT           | 非负整数            |
| usage_instructions     | 用法               | TEXT          | 任意文本            |
| expected_pickup_time   | 预计取药时间       | DATETIME      | YYYY-MM-DD HH:MM:SS |
| pharmacy_id            | 代煎药院ID         | INT           | 主键，自动生成      |
| pharmacy_name          | 代煎药院名称       | VARCHAR(100)  | 非空                |
| machine_id             | 煎药机器ID         | INT           | 主键，自动生成      |
| machine_status         | 机器状态           | VARCHAR(20)   | 空闲/使用中/维护中  |
| decoction_id           | 煎药记录编号       | INT           | 主键，自动生成      |
| pickup_date            | 收方日期           | DATE          | YYYY-MM-DD          |
| formulation_staff      | 配方人员           | VARCHAR(50)   | 非空                |
| formulation_date       | 配方时间           | DATETIME      | YYYY-MM-DD HH:MM:SS |
| soaking_staff          | 浸泡人员           | VARCHAR(50)   | 可为空              |
| soaking_start_time     | 浸泡开始时间       | DATETIME      | 可为空              |
| soaking_end_time       | 浸泡结束时间       | DATETIME      | 可为空              |
| decoction_staff        | 煎药人员           | VARCHAR(50)   | 非空                |
| decoction_start_time   | 煎药开始时间       | DATETIME      | 非空                |
| decoction_end_time     | 煎药结束时间       | DATETIME      | 非空                |
| print_staff            | 成品打印人员       | VARCHAR(50)   | 非空                |
| print_time             | 成品打印时间       | DATETIME      | 非空                |
| actual_pickup_time     | 实际取药时间       | DATETIME      | 可为空              |

---

### **2.3 数据流图（DFD）**

#### **1. 顶层数据流图（Level 0）**
系统顶层数据流展示主要参与方及其交互：
- **患者**提交处方请求并获取取药状态；
- **医生**提交处方开具信息；
- **代煎药院**接收处方并处理煎药；
- **管理系统**提供统计与数据管理服务。

#### **2. 一级数据流图（Level 1）**
按功能模块分解数据流：
1. **患者信息管理模块**：
   - 输入：患者基本信息。
   - 输出：患者查询与更新结果。

2. **处方管理模块**：
   - 输入：处方信息（患者ID、医生ID、剂数等）。
   - 输出：处方记录和状态更新。

3. **代煎管理模块**：
   - 输入：机器状态、煎药时间、成品打印记录。
   - 输出：代煎完成状态。

4. **统计与可视化模块**：
   - 输入：各模块的记录数据。
   - 输出：生成统计报表和可视化结果。
