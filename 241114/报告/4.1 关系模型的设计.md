#### **4.1 关系模型的设计**

将系统的实体及其属性转换为关系模型，定义主键、外键、数据类型和完整性约束条件如下：

---

**患者**  
关系模式：患者（patient_id, patient_name, contact_number）  
- **主键**：patient_id  
- **外键**：无  
- **数据类型**：  
  - patient_id：INT，非空，自动生成  
  - patient_name：VARCHAR(50)，非空  
  - contact_number：VARCHAR(15)，非空  

---

**医生**  
关系模式：医生（doctor_id, doctor_name, department_name）  
- **主键**：doctor_id  
- **外键**：无  
- **数据类型**：  
  - doctor_id：INT，非空，自动生成  
  - doctor_name：VARCHAR(50)，非空  
  - department_name：VARCHAR(50)，非空  

---

**处方**  
关系模式：处方（prescription_id, patient_id, doctor_id, pickup_method, prescription_date, prescription_amount, prescription_weight, dose_count, usage_instructions, expected_pickup_time）  
- **主键**：prescription_id  
- **外键**：patient_id → 患者(patient_id), doctor_id → 医生(doctor_id)  
- **数据类型**：  
  - prescription_id：INT，非空，自动生成  
  - patient_id：INT，非空  
  - doctor_id：INT，非空  
  - pickup_method：VARCHAR(20)，非空  
  - prescription_date：DATE，非空  
  - prescription_amount：DECIMAL(10,2)，非负数  
  - prescription_weight：FLOAT，非负数  
  - dose_count：INT，非负整数  
  - usage_instructions：TEXT，非空  
  - expected_pickup_time：DATETIME，可空  

---

**代煎药院**  
关系模式：代煎药院（pharmacy_id, pharmacy_name）  
- **主键**：pharmacy_id  
- **外键**：无  
- **数据类型**：  
  - pharmacy_id：INT，非空，自动生成  
  - pharmacy_name：VARCHAR(100)，非空  

---

**代煎机器**  
关系模式：代煎机器（machine_id, pharmacy_id, machine_status）  
- **主键**：machine_id  
- **外键**：pharmacy_id → 代煎药院(pharmacy_id)  
- **数据类型**：  
  - machine_id：INT，非空，自动生成  
  - pharmacy_id：INT，非空  
  - machine_status：VARCHAR(20)，非空  

---

**煎药记录**  
关系模式：煎药记录（decoction_id, prescription_id, pharmacy_id, machine_id, pickup_date, formulation_staff, formulation_date, soaking_staff, soaking_start_time, soaking_end_time, decoction_staff, decoction_start_time, decoction_end_time, print_staff, print_time, actual_pickup_time）  
- **主键**：decoction_id  
- **外键**：  
  - prescription_id → 处方(prescription_id)  
  - pharmacy_id → 代煎药院(pharmacy_id)  
  - machine_id → 代煎机器(machine_id)  
- **数据类型**：  
  - decoction_id：INT，非空，自动生成  
  - prescription_id：INT，非空  
  - pharmacy_id：INT，非空  
  - machine_id：INT，非空  
  - pickup_date：DATE，非空  
  - formulation_staff：VARCHAR(50)，非空  
  - formulation_date：DATETIME，非空  
  - soaking_staff：VARCHAR(50)，可空  
  - soaking_start_time：DATETIME，可空  
  - soaking_end_time：DATETIME，可空  
  - decoction_staff：VARCHAR(50)，非空  
  - decoction_start_time：DATETIME，非空  
  - decoction_end_time：DATETIME，非空  
  - print_staff：VARCHAR(50)，非空  
  - print_time：DATETIME，非空  
  - actual_pickup_time：DATETIME，可空 
