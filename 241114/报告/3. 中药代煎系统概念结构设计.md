## **3. 中药代煎系统概念结构设计**

### **3.1 实体及其属性**

#### **1. 患者（Patient）**
- **patient_id**：患者ID（主键）
- **patient_name**：患者姓名
- **contact_number**：联系方式

#### **2. 医生（Doctor）**
- **doctor_id**：医生ID（主键）
- **doctor_name**：医生姓名
- **department_name**：科室名称

#### **3. 处方（Prescription）**
- **prescription_id**：处方编号（主键）
- **patient_id**：患者ID（外键，关联患者）
- **doctor_id**：医生ID（外键，关联医生）
- **pickup_method**：取药方式（自取/配送）
- **prescription_date**：开方日期
- **prescription_amount**：处方金额
- **prescription_weight**：处方重量
- **dose_count**：剂数
- **usage_instructions**：用法

#### **4. 代煎药院（Decoction Pharmacy）**
- **pharmacy_id**：代煎药院ID（主键）
- **pharmacy_name**：代煎药院名称

#### **5. 代煎机器（Decoction Machine）**
- **machine_id**：机器ID（主键）
- **pharmacy_id**：代煎药院ID（外键，关联代煎药院）
- **machine_status**：机器状态（空闲/使用中/维护中）

#### **6. 煎药记录（Decoction Record）**（关系表）
- **decoction_id**：煎药记录编号（主键）
- **prescription_id**：处方编号（外键，关联处方）
- **pharmacy_id**：代煎药院ID（外键，关联代煎药院）
- **machine_id**：代煎机器ID（外键，关联代煎机器）
- **pickup_date**：收方日期
- **formulation_staff**：配方人员
- **formulation_date**：配方时间
- **soaking_staff**：浸泡人员
- **soaking_start_time**：浸泡开始时间
- **soaking_end_time**：浸泡结束时间
- **decoction_staff**：煎药人员
- **decoction_start_time**：煎药开始时间
- **decoction_end_time**：煎药结束时间
- **print_staff**：成品打印人员
- **print_time**：成品打印时间

---

### **3.2 局部ER图**

#### **1. 患者与医生管理子系统**
- **实体**：患者（Patient）、医生（Doctor）
- **关系**：一个患者可以关联多张处方；每张处方由一名医生开具。
- **ER图**：
  ```
  Patient (patient_id) --< Prescription (prescription_id) >-- Doctor (doctor_id)
  ```

#### **2. 处方与代煎药院管理子系统**
- **实体**：处方（Prescription）、代煎药院（Decoction Pharmacy）
- **关系**：每张处方交由一个代煎药院处理。
- **ER图**：
  ```
  Prescription (prescription_id) --< Decoction Pharmacy (pharmacy_id)
  ```

#### **3. 代煎药院与煎药机器管理子系统**
- **实体**：代煎药院（Decoction Pharmacy）、代煎机器（Decoction Machine）
- **关系**：一个代煎药院可以拥有多台代煎机器。
- **ER图**：
  ```
  Decoction Pharmacy (pharmacy_id) --< Decoction Machine (machine_id)
  ```

#### **4. 煎药记录管理子系统**
- **实体**：处方（Prescription）、代煎药院（Decoction Pharmacy）、代煎机器（Decoction Machine）
- **关系**：每张处方对应一条煎药记录，记录其在代煎药院的煎药过程。
- **ER图**：
  ```
  Prescription (prescription_id) --< Decoction Record (decoction_id) >-- Decoction Machine (machine_id)
  ```

---

### **3.3 全局ER图**

整合所有实体及其关系，形成全局ER图：

```
Patient (patient_id) --< Prescription (prescription_id) >-- Doctor (doctor_id)
Prescription (prescription_id) --< Decoction Record (decoction_id) >-- Decoction Machine (machine_id)
Decoction Machine (machine_id) --< Decoction Pharmacy (pharmacy_id)
```

- **患者与医生通过处方关联**；
- **处方与煎药记录关联，煎药记录与代煎药院及代煎机器关联**；
- **代煎药院与其内部设备（代煎机器）关联**。
